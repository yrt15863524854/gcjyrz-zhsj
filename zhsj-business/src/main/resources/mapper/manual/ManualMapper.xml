<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhsj.business.manual.mapper.ManualMapper">
    <resultMap id="manualResult" type="com.zhsj.business.manual.dto.ManualDto">
        <result column="className" property="className"/>
        <result column="manual_name" property="manualName"/>
        <result column="student_group" property="studentGroup"/>
        <result column="courseName" property="courseName"/>
        <result column="is_audit" property="isAudit"/>
        <result column="feedback" property="feedback"/>
    </resultMap>
    <select id="listManualInfo" resultMap="manualResult" parameterType="com.zhsj.business.manual.dto.ManualQueryDto">
        select bm.manual_name,bm.student_group,bm.feedback,bm.is_audit,bc.class_name as className,bc2.course_name as courseName from business_manual bm left join business_class bc
        on bc.class_code = bm.class_code left join business_course bc2 on bc2 .course_code = bm .course_code
        <where>
            bm.course_code =
            (select course_code from business_course_teacher bct where bm.course_code = bct.course_code and
            bct.teacher_code = #{dto.teacherCode})
            <if test="dto.courseCode != null and dto.courseCode != ''">and bm.course_code = #{dto.courseCode}</if>
            <if test="dto.classCode != null and dto.classCode != ''">and bm.class_code = #{dto.classCode}</if>
        </where>
    </select>
</mapper>
